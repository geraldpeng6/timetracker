#!/bin/bash

# TimeTracker Pre-commit Hook
# 在每次 git commit 前自动运行代码质量检查

set -e

echo "🔍 运行 pre-commit 检查..."

# 1. 代码格式检查
echo "📝 检查代码格式..."
if ! cargo fmt --all -- --check; then
    echo "❌ 代码格式检查失败"
    echo "💡 运行 'cargo fmt --all' 修复格式问题"
    exit 1
fi
echo "✅ 代码格式检查通过"

# 2. Clippy 静态分析
echo "🔍 运行 Clippy 静态分析..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo "❌ Clippy 检查失败"
    echo "💡 请修复上述警告和错误"
    exit 1
fi
echo "✅ Clippy 检查通过"

# 3. 快速编译检查
echo "🔨 编译检查..."
if ! cargo check; then
    echo "❌ 编译检查失败"
    exit 1
fi
echo "✅ 编译检查通过"

echo "🎉 Pre-commit 检查通过！"