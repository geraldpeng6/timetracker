#!/bin/bash

# TimeTracker Pre-commit Hook
# åœ¨æ¯æ¬¡ git commit å‰è‡ªåŠ¨è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥

set -e

echo "ğŸ” è¿è¡Œ pre-commit æ£€æŸ¥..."

# 1. ä»£ç æ ¼å¼æ£€æŸ¥
echo "ğŸ“ æ£€æŸ¥ä»£ç æ ¼å¼..."
if ! cargo fmt --all -- --check; then
    echo "âŒ ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥"
    echo "ğŸ’¡ è¿è¡Œ 'cargo fmt --all' ä¿®å¤æ ¼å¼é—®é¢˜"
    exit 1
fi
echo "âœ… ä»£ç æ ¼å¼æ£€æŸ¥é€šè¿‡"

# 2. Clippy é™æ€åˆ†æ
echo "ğŸ” è¿è¡Œ Clippy é™æ€åˆ†æ..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo "âŒ Clippy æ£€æŸ¥å¤±è´¥"
    echo "ğŸ’¡ è¯·ä¿®å¤ä¸Šè¿°è­¦å‘Šå’Œé”™è¯¯"
    exit 1
fi
echo "âœ… Clippy æ£€æŸ¥é€šè¿‡"

# 3. å¿«é€Ÿç¼–è¯‘æ£€æŸ¥
echo "ğŸ”¨ ç¼–è¯‘æ£€æŸ¥..."
if ! cargo check; then
    echo "âŒ ç¼–è¯‘æ£€æŸ¥å¤±è´¥"
    exit 1
fi
echo "âœ… ç¼–è¯‘æ£€æŸ¥é€šè¿‡"

echo "ğŸ‰ Pre-commit æ£€æŸ¥é€šè¿‡ï¼"